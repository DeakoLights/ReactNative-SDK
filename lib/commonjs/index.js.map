{"version":3,"sources":["index.tsx"],"names":["LINKING_ERROR","Platform","select","ios","default","GleapSdk","NativeModules","Gleapsdk","Proxy","get","Error","touched","networkLogger","GleapNetworkIntercepter","startNetworkLogging","start","stopNetworkLogging","setStopped","callbacks","registerListener","eventType","callback","push","registerCustomAction","customActionCallback","notifyCallback","data","length","i","gleapEmitter","NativeEventEmitter","addListener","config","configJSON","Object","JSON","parse","enableNetworkLogs","exp","requests","getRequests","OS","attachNetworkLog","stringify","dataJSON","isJsonString","str","e","name","removeAllAttachments"],"mappings":"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","sourcesContent":["import { NativeModules, NativeEventEmitter, Platform } from 'react-native';\nimport GleapNetworkIntercepter from './networklogger';\n\nconst LINKING_ERROR =\n  `The package 'react-native-gleapsdk' doesn't seem to be linked. Make sure: \\n\\n` +\n  Platform.select({ ios: \"- You have run 'pod install'\\n\", default: '' }) +\n  '- You rebuilt the app after installing the package\\n' +\n  '- You are not using Expo managed workflow\\n';\n\nexport type GleapUserProperty = {\n  email?: string;\n  name?: string;\n};\n\ntype GleapActivationMethod = 'SHAKE' | 'SCREENSHOT';\n\ntype GleapSdkType = {\n  initialize(token: string): void;\n  open(): void;\n  startFeedbackFlow(feedbackFlow: string): void;\n  sendSilentBugReport(\n    description: string,\n    severity: 'LOW' | 'MEDIUM' | 'HIGH'\n  ): void;\n  sendSilentBugReportWithType(\n    description: string,\n    severity: 'LOW' | 'MEDIUM' | 'HIGH',\n    type: string\n  ): void;\n  identify(userId: string, userProperties: GleapUserProperty): void;\n  clearIdentity(): void;\n  setApiUrl(apiUrl: string): void;\n  setWidgetUrl(widgetUrl: string): void;\n  attachCustomData(customData: any): void;\n  setCustomData(key: string, value: string): void;\n  removeCustomDataForKey(key: string): void;\n  clearCustomData(): void;\n  registerCustomAction(\n    customActionCallback: (data: { name: string }) => void\n  ): void;\n  registerListener(eventType: string, callback: (data?: any) => void): void;\n  setLanguage(language: string): void;\n  logEvent(name: string, data: any): void;\n  addAttachment(base64file: string, fileName: string): void;\n  removeAllAttachments(): void;\n  startNetworkLogging(): void;\n  stopNetworkLogging(): void;\n  enableDebugConsoleLog(): void;\n  setActivationMethods(activationMethods: GleapActivationMethod[]): void;\n};\n\nconst GleapSdk = NativeModules.Gleapsdk\n  ? NativeModules.Gleapsdk\n  : new Proxy(\n      {},\n      {\n        get() {\n          throw new Error(LINKING_ERROR);\n        },\n      }\n    );\n\nif (GleapSdk && !GleapSdk.touched) {\n  const networkLogger = new GleapNetworkIntercepter();\n\n  GleapSdk.startNetworkLogging = () => {\n    networkLogger.start();\n  };\n\n  GleapSdk.stopNetworkLogging = () => {\n    networkLogger.setStopped(true);\n  };\n\n  var callbacks: any = {};\n\n  GleapSdk.registerListener = (eventType: string, callback: any) => {\n    if (!callbacks[eventType]) {\n      callbacks[eventType] = [];\n    }\n    callbacks[eventType].push(callback);\n  };\n\n  GleapSdk.registerCustomAction = (customActionCallback: any) => {\n    GleapSdk.registerListener('customActionTriggered', customActionCallback);\n  };\n\n  const notifyCallback = function (eventType: string, data?: any) {\n    if (callbacks && callbacks[eventType] && callbacks[eventType].length > 0) {\n      for (var i = 0; i < callbacks[eventType].length; i++) {\n        if (callbacks[eventType][i]) {\n          callbacks[eventType][i](data);\n        }\n      }\n    }\n  };\n\n  const gleapEmitter = new NativeEventEmitter(NativeModules.Gleapsdk);\n\n  gleapEmitter.addListener('configLoaded', (config: any) => {\n    try {\n      const configJSON = config instanceof Object ? config : JSON.parse(config);\n      if (configJSON.enableNetworkLogs) {\n        GleapSdk.startNetworkLogging();\n      }\n      notifyCallback('configLoaded', configJSON);\n    } catch (exp) {}\n  });\n\n  gleapEmitter.addListener('feedbackWillBeSent', () => {\n    // Push the network log to the native SDK.\n    const requests = networkLogger.getRequests();\n    if (Platform.OS === 'android') {\n      GleapSdk.attachNetworkLog(JSON.stringify(requests));\n    } else {\n      GleapSdk.attachNetworkLog(JSON.parse(JSON.stringify(requests)));\n    }\n\n    notifyCallback('feedbackWillBeSent');\n  });\n\n  gleapEmitter.addListener('feedbackSent', (data) => {\n    try {\n      const dataJSON = data instanceof Object ? data : JSON.parse(data);\n      notifyCallback('feedbackSent', dataJSON);\n    } catch (exp) {}\n  });\n\n  gleapEmitter.addListener('feedbackSendingFailed', () => {\n    notifyCallback('feedbackSendingFailed');\n  });\n\n  function isJsonString(str: string) {\n    try {\n      JSON.parse(str);\n    } catch (e) {\n      return false;\n    }\n    return true;\n  }\n\n  gleapEmitter.addListener('customActionTriggered', (data: any) => {\n    try {\n      if (isJsonString(data)) {\n        data = JSON.parse(data);\n      }\n      const { name } = data;\n      if (name) {\n        notifyCallback('customActionTriggered', {\n          name,\n        });\n      }\n    } catch (exp) {}\n  });\n\n  GleapSdk.removeAllAttachments();\n\n  GleapSdk.touched = true;\n}\n\nexport default GleapSdk as GleapSdkType;\n"]}