{"version":3,"sources":["networklogger.ts"],"names":["GleapNetworkIntercepter","getRequests","Object","values","requests","setMaxRequests","maxRequests","setStopped","stopped","cleanRequests","keys","length","keysToRemove","slice","i","calcRequestTime","gleapRequestId","startDate","date","getTime","isFrozen","duration","Date","toString","contentSizeOk","text","size","kiloBytes","megaBytes","start","interceptNetworkRequests","onFetch","params","method","request","payload","body","headers","type","url","onFetchLoad","req","success","response","status","statusText","responseText","exp","then","catch","_err","onFetchFailed","onOpen","args","onSend","requestHeaders","onError","onLoad","contentType","getResponseHeader","isTextOrJSON","includes","responseType","_response","callback","self","XMLHttpRequest","prototype","open","send","wrappedSetRequestHeader","setRequestHeader","header","value","hasOwnProperty","push","requestId","arguments","addEventListener","apply","global","originalFetch","fetch","clone","data","err"],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\nclass GleapNetworkIntercepter {\n  requestId = 0;\n  requests: any = {};\n  maxRequests = 10;\n  stopped = false;\n\n  getRequests() {\n    return Object.values(this.requests);\n  }\n\n  setMaxRequests(maxRequests: number) {\n    this.maxRequests = maxRequests;\n  }\n\n  setStopped(stopped: boolean) {\n    this.stopped = stopped;\n  }\n\n  cleanRequests() {\n    var keys = Object.keys(this.requests);\n    if (keys.length > this.maxRequests) {\n      var keysToRemove = keys.slice(0, keys.length - this.maxRequests);\n      for (var i = 0; i < keysToRemove.length; i++) {\n        delete this.requests[keysToRemove[i]];\n      }\n    }\n  }\n\n  calcRequestTime(gleapRequestId: string | number) {\n    if (!this.requests[gleapRequestId]) {\n      return;\n    }\n\n    var startDate = this.requests[gleapRequestId].date;\n    if (\n      startDate &&\n      typeof startDate.getTime === 'function' &&\n      !Object.isFrozen(this.requests[gleapRequestId])\n    ) {\n      this.requests[gleapRequestId].duration =\n        new Date().getTime() - startDate.getTime();\n      this.requests[gleapRequestId].date =\n        this.requests[gleapRequestId].date.toString();\n    }\n  }\n\n  contentSizeOk(text: string) {\n    if (text && text.length) {\n      const size = text.length * 16;\n      const kiloBytes = size / 1024;\n      const megaBytes = kiloBytes / 1024;\n      if (megaBytes < 0.5) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  start() {\n    this.setStopped(false);\n    this.interceptNetworkRequests({\n      onFetch: (params: any, gleapRequestId: any) => {\n        if (this.stopped) {\n          return;\n        }\n\n        if (params.length >= 2) {\n          var method = params[1].method ? params[1].method : 'GET';\n          this.requests[gleapRequestId] = {\n            request: {\n              payload: params[1].body,\n              headers: params[1].headers,\n            },\n            type: method,\n            url: params[0],\n            date: new Date(),\n          };\n        } else {\n          this.requests[gleapRequestId] = {\n            request: {},\n            url: params[0],\n            type: 'GET',\n            date: new Date(),\n          };\n        }\n\n        this.cleanRequests();\n      },\n      onFetchLoad: (req: any, gleapRequestId: any) => {\n        if (\n          this.stopped ||\n          !gleapRequestId ||\n          !this.requests ||\n          !this.requests[gleapRequestId]\n        ) {\n          return;\n        }\n\n        try {\n          this.requests[gleapRequestId].success = true;\n          this.requests[gleapRequestId].response = {\n            status: req.status,\n            statusText: '',\n            responseText: '<request_still_open>',\n          };\n          this.calcRequestTime(gleapRequestId);\n        } catch (exp) {}\n\n        req\n          .text()\n          .then((responseText: any) => {\n            if (this.requests && this.requests[gleapRequestId]) {\n              this.requests[gleapRequestId].success = true;\n              this.requests[gleapRequestId].response = {\n                status: req.status,\n                statusText: req.statusText,\n                responseText: this.contentSizeOk(responseText)\n                  ? responseText\n                  : '<response_too_large>',\n              };\n\n              this.calcRequestTime(gleapRequestId);\n              this.cleanRequests();\n            }\n          })\n          .catch((_err: any) => {\n            if (this) {\n              this.cleanRequests();\n            }\n          });\n      },\n      onFetchFailed: (_err: any, gleapRequestId: any) => {\n        if (this.stopped) {\n          return;\n        }\n\n        this.requests[gleapRequestId].success = false;\n        this.calcRequestTime(gleapRequestId);\n        this.cleanRequests();\n      },\n      onOpen: (request: any, args: string | any[]) => {\n        if (this.stopped) {\n          return;\n        }\n\n        if (\n          request &&\n          request.gleapRequestId &&\n          args.length >= 2 &&\n          this.requests\n        ) {\n          this.requests[request.gleapRequestId] = {\n            type: args[0],\n            url: args[1],\n            date: new Date(),\n          };\n        }\n\n        this.cleanRequests();\n      },\n      onSend: (request: any, args: string | any[]) => {\n        if (this.stopped) {\n          return;\n        }\n\n        if (\n          request &&\n          request.gleapRequestId &&\n          this.requests &&\n          this.requests[request.gleapRequestId]\n        ) {\n          this.requests[request.gleapRequestId].request = {\n            payload: args.length > 0 ? args[0] : '',\n            headers: request.requestHeaders,\n          };\n        }\n\n        this.cleanRequests();\n      },\n      onError: (request: any) => {\n        if (\n          !this.stopped &&\n          this.requests &&\n          request &&\n          request.gleapRequestId &&\n          this.requests[request.gleapRequestId]\n        ) {\n          this.requests[request.gleapRequestId].success = false;\n          this.calcRequestTime(request.gleapRequestId);\n        }\n\n        this.cleanRequests();\n      },\n      onLoad: (request: any) => {\n        if (this.stopped) {\n          return;\n        }\n\n        if (\n          request &&\n          request.gleapRequestId &&\n          this.requests &&\n          this.requests[request.gleapRequestId]\n        ) {\n          const contentType = request.getResponseHeader('content-type');\n          const isTextOrJSON =\n            contentType &&\n            (contentType.includes('json') || contentType.includes('text'));\n\n          var responseText = '<' + contentType + '>';\n          if (request.responseType === '' || request.responseType === 'text') {\n            responseText = request.responseText;\n          }\n          if (request._response && isTextOrJSON) {\n            responseText = request._response;\n          }\n\n          this.requests[request.gleapRequestId].success = true;\n          this.requests[request.gleapRequestId].response = {\n            status: request.status,\n            responseText: this.contentSizeOk(responseText)\n              ? responseText\n              : '<response_too_large>',\n          };\n\n          this.calcRequestTime(request.gleapRequestId);\n        }\n\n        this.cleanRequests();\n      },\n    });\n  }\n\n  interceptNetworkRequests(callback: any) {\n    // eslint-disable-next-line consistent-this\n    var self = this;\n\n    // @ts-ignore\n    if (XMLHttpRequest.prototype['gleapTouched']) {\n      return;\n    }\n\n    // @ts-ignore\n    XMLHttpRequest.prototype['gleapTouched'] = true;\n\n    // XMLHttpRequest\n    const open = XMLHttpRequest.prototype.open;\n    const send = XMLHttpRequest.prototype.send;\n\n    // @ts-ignore\n    XMLHttpRequest.prototype.wrappedSetRequestHeader =\n      XMLHttpRequest.prototype.setRequestHeader;\n    XMLHttpRequest.prototype.setRequestHeader = function (header, value) {\n      // @ts-ignore\n      if (!this.requestHeaders) {\n        // @ts-ignore\n        this.requestHeaders = {};\n      }\n\n      // @ts-ignore\n      if (this.requestHeaders && this.requestHeaders.hasOwnProperty(header)) {\n        return;\n      }\n\n      // @ts-ignore\n      if (!this.requestHeaders[header]) {\n        // @ts-ignore\n        this.requestHeaders[header] = [];\n      }\n\n      // @ts-ignore\n      this.requestHeaders[header].push(value);\n      // @ts-ignore\n      this.wrappedSetRequestHeader(header, value);\n    };\n\n    XMLHttpRequest.prototype.open = function () {\n      (this as any).gleapRequestId = ++self.requestId;\n      callback.onOpen && callback.onOpen(this, arguments);\n\n      if (callback.onLoad) {\n        this.addEventListener('load', function () {\n          // @ts-ignore\n          callback.onLoad(this);\n        });\n      }\n      if (callback.onError) {\n        this.addEventListener('error', function () {\n          // @ts-ignore\n          callback.onError(this);\n        });\n      }\n\n      // @ts-ignore\n      return open.apply(this, arguments);\n    };\n\n    XMLHttpRequest.prototype.send = function () {\n      callback.onSend && callback.onSend(this, arguments);\n      // @ts-ignore\n      return send.apply(this, arguments);\n    };\n\n    // Fetch\n    if (global) {\n      (function () {\n        var originalFetch = global.fetch;\n        global.fetch = function () {\n          var gleapRequestId = ++self.requestId;\n          callback.onFetch(arguments, gleapRequestId);\n\n          return (\n            originalFetch\n              // @ts-ignore\n              .apply(this, arguments)\n              .then(function (response) {\n                if (response && typeof response.clone === 'function') {\n                  const data = response.clone();\n                  callback.onFetchLoad(data, gleapRequestId);\n                }\n\n                return response;\n              })\n              .catch((err) => {\n                callback.onFetchFailed(err, gleapRequestId);\n                throw err;\n              })\n          );\n        };\n      })();\n    }\n\n    return callback;\n  }\n}\n\nexport default GleapNetworkIntercepter;\n"]}