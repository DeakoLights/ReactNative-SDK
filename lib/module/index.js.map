{"version":3,"sources":["index.tsx"],"names":["NativeModules","NativeEventEmitter","Platform","GleapNetworkIntercepter","LINKING_ERROR","select","ios","default","GleapSdk","Gleapsdk","Proxy","get","Error","touched","networkLogger","startNetworkLogging","setUpdatedCallback","requests","getRequests","attachNetworkLog","OS","JSON","stringify","parse","start","stopNetworkLogging","setStopped","callbacks","registerListener","eventType","callback","push","registerCustomAction","customActionCallback","notifyCallback","data","length","i","gleapEmitter","addListener","config","configJSON","Object","enableNetworkLogs","exp","dataJSON","feedbackAction","isJsonString","str","e","name","removeAllAttachments"],"mappings":"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","sourcesContent":["import { NativeModules, NativeEventEmitter, Platform } from 'react-native';\nimport GleapNetworkIntercepter from './networklogger';\n\nconst LINKING_ERROR =\n  `The package 'react-native-gleapsdk' doesn't seem to be linked. Make sure: \\n\\n` +\n  Platform.select({ ios: \"- You have run 'pod install'\\n\", default: '' }) +\n  '- You rebuilt the app after installing the package\\n' +\n  '- You are not using Expo managed workflow\\n';\n\nexport type GleapUserProperty = {\n  email?: string;\n  name?: string;\n  phone?: string;\n  value?: number;\n};\n\ntype GleapActivationMethod = 'SHAKE' | 'SCREENSHOT';\n\ntype GleapSdkType = {\n  initialize(token: string): void;\n  startFeedbackFlow(feedbackFlow: string, showBackButton: boolean): void;\n  sendSilentCrashReport(\n    description: string,\n    severity: 'LOW' | 'MEDIUM' | 'HIGH'\n  ): void;\n  sendSilentCrashReportWithExcludeData(\n    description: string,\n    severity: 'LOW' | 'MEDIUM' | 'HIGH',\n    excludeData: {\n      customData?: Boolean;\n      metaData?: Boolean;\n      attachments?: Boolean;\n      consoleLog?: Boolean;\n      networkLogs?: Boolean;\n      customEventLog?: Boolean;\n      screenshot?: Boolean;\n      replays?: Boolean;\n    }\n  ): void;\n  open(): void;\n  close(): void;\n  isOpened(): boolean;\n  identify(userId: string, userProperties: GleapUserProperty): void;\n  identifyWithUserHash(\n    userId: string,\n    userProperties: GleapUserProperty,\n    userHash: string\n  ): void;\n  clearIdentity(): void;\n  preFillForm(formData: { [key: string]: string }): void;\n  setApiUrl(apiUrl: string): void;\n  setFrameUrl(frameUrl: string): void;\n  attachCustomData(customData: any): void;\n  setCustomData(key: string, value: string): void;\n  removeCustomDataForKey(key: string): void;\n  clearCustomData(): void;\n  registerListener(eventType: string, callback: (data?: any) => void): void;\n  setLanguage(language: string): void;\n  enableDebugConsoleLog(): void;\n  disableConsoleLog(): void;\n  log(message: string): void;\n  logWithLogLevel(message: string, logLevel: 'INFO' | 'WARNING' | 'ERROR'): void;\n  trackEvent(name: string, data: any): void;\n  addAttachment(base64file: string, fileName: string): void;\n  removeAllAttachments(): void;\n  startNetworkLogging(): void;\n  stopNetworkLogging(): void;\n  setActivationMethods(activationMethods: GleapActivationMethod[]): void;\n  registerCustomAction(\n    customActionCallback: (data: { name: string }) => void\n  ): void;\n};\n\nconst GleapSdk = NativeModules.Gleapsdk\n  ? NativeModules.Gleapsdk\n  : new Proxy(\n    {},\n    {\n      get() {\n        throw new Error(LINKING_ERROR);\n      },\n    }\n  );\n\nif (GleapSdk && !GleapSdk.touched) {\n  const networkLogger = new GleapNetworkIntercepter();\n\n  // Push the network log to the native SDK.\n  GleapSdk.startNetworkLogging = () => {\n    // Set the callback.\n    networkLogger.setUpdatedCallback(() => {\n      if (!networkLogger) {\n        return;\n      }\n\n      const requests = networkLogger.getRequests();\n   \n      if (requests && GleapSdk && typeof GleapSdk.attachNetworkLog !== 'undefined') {\n        if (Platform.OS === 'android') {\n          GleapSdk.attachNetworkLog(JSON.stringify(requests));\n        } else {\n          GleapSdk.attachNetworkLog(JSON.parse(JSON.stringify(requests)));\n        }\n      }\n    });\n\n    // Start the logger.\n    networkLogger.start();\n  };\n\n  GleapSdk.stopNetworkLogging = () => {\n    networkLogger.setStopped(true);\n  };\n\n  var callbacks: any = {};\n\n  GleapSdk.registerListener = (eventType: string, callback: any) => {\n    if (!callbacks[eventType]) {\n      callbacks[eventType] = [];\n    }\n    callbacks[eventType].push(callback);\n  };\n\n  GleapSdk.registerCustomAction = (customActionCallback: any) => {\n    GleapSdk.registerListener('customActionTriggered', customActionCallback);\n  };\n\n  const notifyCallback = function (eventType: string, data?: any) {\n    if (callbacks && callbacks[eventType] && callbacks[eventType].length > 0) {\n      for (var i = 0; i < callbacks[eventType].length; i++) {\n        if (callbacks[eventType][i]) {\n          callbacks[eventType][i](data);\n        }\n      }\n    }\n  };\n\n  const gleapEmitter = new NativeEventEmitter(NativeModules.Gleapsdk);\n\n  gleapEmitter.addListener('configLoaded', (config: any) => {\n    try {\n      const configJSON = config instanceof Object ? config : JSON.parse(config);\n      if (configJSON.enableNetworkLogs) {\n        GleapSdk.startNetworkLogging();\n      }\n      notifyCallback('configLoaded', configJSON);\n    } catch (exp) { }\n  });\n\n  gleapEmitter.addListener('feedbackSent', (data) => {\n    try {\n      const dataJSON = data instanceof Object ? data : JSON.parse(data);\n      notifyCallback('feedbackSent', dataJSON);\n    } catch (exp) { }\n  });\n\n  gleapEmitter.addListener('feedbackFlowStarted', (feedbackAction) => {\n    notifyCallback('feedbackFlowStarted', feedbackAction);\n  });\n\n  gleapEmitter.addListener('feedbackSendingFailed', () => {\n    notifyCallback('feedbackSendingFailed');\n  });\n\n  gleapEmitter.addListener('widgetOpened', () => {\n    notifyCallback('widgetOpened');\n  });\n\n  gleapEmitter.addListener('widgetClosed', () => {\n    notifyCallback('widgetClosed');\n  });\n\n  function isJsonString(str: string) {\n    try {\n      JSON.parse(str);\n    } catch (e) {\n      return false;\n    }\n    return true;\n  }\n\n  gleapEmitter.addListener('customActionTriggered', (data: any) => {\n    try {\n      if (isJsonString(data)) {\n        data = JSON.parse(data);\n      }\n      const { name } = data;\n      if (name) {\n        notifyCallback('customActionTriggered', {\n          name,\n        });\n      }\n    } catch (exp) { }\n  });\n\n  GleapSdk.removeAllAttachments();\n  GleapSdk.touched = true;\n}\n\nexport default GleapSdk as GleapSdkType;\n"]}